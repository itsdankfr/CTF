# REV5 Writeup by `whales`

#### Start from the source file, got the overall look which contains so many xors in PHP.
#### I didn't got any PHP IDE yet so i copied the source into some online PHP compiler, and it looked sth like this: 
![image](https://github.com/user-attachments/assets/310f9222-512e-4497-9ab9-f68b8f9d3b24)
#### Ran it down, got the input request like `"FLAG"` so this must be the type to reverse the source code to find out the flag
#### From that moment i can understand what this PHP does, maybe it xor a lot of characters and the result must be sth readable
#### Thus i wrote a php program to print out what the character or its ascii number is: 
![image](https://github.com/user-attachments/assets/d8630d6a-a0b0-4ae0-aab0-6dcf5be78980)
#### Then for about 2 or 3 hours straight, i just copy the xor into the function to print out the character then go into VScode, `ctrl F` to find then `replace all` the same xor in other positions
![image](https://github.com/user-attachments/assets/2e56a4bc-2b74-41ea-9da2-9d46ce4a5600)
#### After a while struglle with the xors, i have nearly done with finding out character ( here are the codes i sent to my team when i just made some progress )
```
<?php
((''.'8'^'\\').(''.'8'^']').(''.'8'^'^').(''.'7'^'^').(''.'0'^'^').(''.'8'^']'))((''.'8'^'~'),((''.'2'^'@').(''.'8'^']').('('^'I').(''.'8'^'\\').(''.'0'^'\\').(''.'7'^'^').(''.'0'^'^').(''.'8'^']'))((''.'8'^'~').(''.'0'^'\\').('('^'I').(''.'8'^'_').':'.' ')).(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'8'^'[').(''.'0'^']').(''.'0'^'@'))(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'0'^'\\').(''.'8'^']').(''.'0'^'^'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~'))),(''.'2').(''.'2'))?((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']')):(((''.'7'^'^').(''.'0'^'^').('_').('('^'I').(''.'2'^'@').(''.'2'^'@').('('^'I').(''.'9'^'@'))(((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.'0'),(''.'8')),[(''.'0'^'`').(''.'4'^'`').(''.'7'^'~').(''.'4'^'`').(''.'8'^'{').(''.'4'^'`').(''.'8'^'~').('{'),])?(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'0'^'^').('('^'I').(''.'4'^'@').(''.'8'^'[').(''.'0'^']').(''.'0'^'@'))(('['^'{').('['^'g').('['^'B').('['^'P').('['^')').('['^'|').('['^'B').('['^'a'),((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.'0'),(''.'8'))^((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.'8'),(''.'8')))?((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']')):(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'0'^'^').('('^'I').(''.'4'^'@').(''.'8'^'[').(''.'0'^']').(''.'0'^'@'))((''.'3').(''.'8').(''.'9'^'[').(''.'8'^']').(''.('strlen')('+_)(*)')).(''.('strlen')('^')).(''.'8'^'[').(''.'0').(''.'8'^']').(''.'8'^'[').(''.'8').(''.'8'^'\\').(''.('strlen')('^')).(''.('strlen')('^')).(''.'2').(''.('strlen')('^')).(''.'2').(''.'4').(''.'8'^']').(''.'8'^']').(''.('strlen')('^%$@&')).(''.'0').('('^'I').(''.'4').('('^'I').(''.('strlen')('^')).(''.('strlen')('^')).(''.'8').(''.'9').(''.'2').(''.('strlen')('+_)(*)')).(''.'8'^'\\'),((''.'0'^']').(''.'8'^'\\').(''.('strlen')('^%$@&')))(((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.('strlen')('^')).(''.('strlen')('+_)(*)')),(''.('strlen')('^%$@&')))))?((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']')):((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'9'^'@').(''.'8'^']').(''.'3'^'@')))):((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']'))))
?>
```

```
<?php
((''.'8'^'\\').(''.'8'^']').(''.'8'^'^').(''.'7'^'^').(''.'0'^'^').(''.'8'^']'))((''.'8'^'~'),((''.'2'^'@').(''.'8'^']').('('^'I').(''.'8'^'\\').(''.'0'^'\\').(''.'7'^'^').(''.'0'^'^').(''.'8'^']'))((''.'8'^'~').(''.'0'^'\\').('('^'I').(''.'8'^'_').':'.' ')).(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'8'^'[').(''.'0'^']').(''.'0'^'@'))(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'0'^'\\').(''.'8'^']').(''.'0'^'^'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~'))),(''.'2').(''.'2'))?((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']')):(((''.'7'^'^').(''.'0'^'^').('_').('('^'I').(''.'2'^'@').(''.'2'^'@').('('^'I').(''.'9'^'@'))(((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.'0'),(''.'8')),[(''.'0'^'`').(''.'4'^'`').(''.'7'^'~').(''.'4'^'`').(''.'8'^'{').(''.'4'^'`').(''.'8'^'~').('{'),])?(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'0'^'^').('('^'I').(''.'4'^'@').(''.'8'^'[').(''.'0'^']').(''.'0'^'@'))(('['^'{').('['^'g').('['^'B').('['^'P').('['^')').('['^'|').('['^'B').('['^'a'),((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.'0'),(''.'8'))^((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.'8'),(''.'8')))?((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']')):(((''.'3'^'@').(''.'4'^'@').(''.'2'^'@').(''.'0'^'^').('('^'I').(''.'4'^'@').(''.'8'^'[').(''.'0'^']').(''.'0'^'@'))((''.'3').(''.'8').(''.'9'^'[').(''.'8'^']').(''.('strlen')('+_)(*)')).(''.('strlen')('^')).(''.'8'^'[').(''.'0').(''.'8'^']').(''.'8'^'[').(''.'8').(''.'8'^'\\').(''.('strlen')('^')).(''.('strlen')('^')).(''.'2').(''.('strlen')('^')).(''.'2').(''.'4').(''.'8'^']').(''.'8'^']').(''.('strlen')('^%$@&')).(''.'0').('('^'I').(''.'4').('('^'I').(''.('strlen')('^')).(''.('strlen')('^')).(''.'8').(''.'9').(''.'2').(''.('strlen')('+_)(*)')).(''.'8'^'\\'),((''.'0'^']').(''.'8'^'\\').(''.('strlen')('^%$@&')))(((''.'3'^'@').(''.('strlen')('^%$@&')^'@').(''.'9'^'[').(''.'3'^'@').(''.'4'^'@').(''.'2'^'@'))(((''.'8'^'[').(''.'0'^'_').(''.'0'^'^').(''.'3'^'@').(''.'4'^'@').('('^'I').(''.'0'^'^').(''.'4'^'@'))((''.'8'^'~')),(''.('strlen')('^')).(''.('strlen')('+_)(*)')),(''.('strlen')('^%$@&')))))?((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']')):((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'9'^'@').(''.'8'^']').(''.'3'^'@')))):((''.'0'^'@').(''.'2'^'@').(''.'7'^'^').(''.'0'^'^').(''.'4'^'@').(''.'8'^'^'))((''.'0'^'~').(''.'0'^'_').(''.'0'^'@').(''.'8'^']'))))
?>

```

#### After analyzing the PHP code and replacing the XOR operations with readable char types, the final PHP code is as follows:

```
<?php
define("F", readline("Flag: "));

// Check if the flag length is 22
if (strlen(constant("F")) !== 22) {
    printf("Nope");
    exit;
}

// Check if the flag starts with "PTITCTF{"
if (substr(constant("F"), 0, 8) !== "PTITCTF{") {
    printf("Nope");
    exit;
}

// Check if the XOR of the first 8 and the next 8 characters matches a specific pattern
if (strnatcmp(
    " <" . chr(25) . chr(11) . "r'" . chr(25) . ":",
    substr(constant("F"), 0, 8) ^ substr(constant("F"), 8, 8)
) !== 0) {
    printf("Nope");
    exit;
}

// Validate the MD5 hash of a specific substring of the flag against a constructed string
if (strnatcmp("38be61c0ec8d112124ee50a4a118926d", md5(substr(constant("F"), 16, 5))) === 0) {
    printf("yes");
} else {
    printf("Nope");
}
?>
```

### By analyzing this code, we observe the following:

#### - The flag must be 22 characters long. Therefore, it will have the form PTITCTF{xxxxxxxxxxxxx}.
#### - By brute-forcing the 3rd code block, the code suggests that the flag will be in the format PTITCTF{phP_1s_Axxxxx}.
#### - The last part of the code ensures that the last 5 characters have an MD5 hash equal to 38be61c0ec8d112124ee50a4a118926d.

#### So, all we need to do is brute-force the flag to find the correct one. Below is the brute-force code written in PHP using 5 nested for loops:

```
<?php
    $knownflag = "PTITCTF{phP_1s_Axxxxx}";
    $target_md5 = "38be61c0ec8d112124ee50a4a118926d";
    $possible = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~`!@#$%^&*()-';
    $lenPos = strlen($possible);

    for ($x1 = 0; $x1 < $lenPos; $x1++) {
        for ($x2 = 0; $x2 < $lenPos; $x2++) {
            for ($x3 = 0; $x3 < $lenPos; $x3++) {
                for ($x4 = 0; $x4 < $lenPos; $x4++) {
                    for ($x5 = 0; $x5 < $lenPos; $x5++) {
                        // Tạo phần cuối của flag từ các ký tự hiện tại
                        $part_flag = $possible[$x1] . $possible[$x2] . $possible[$x3] . $possible[$x4] . $possible[$x5];

                        // Tạo flag hoàn chỉnh
                        $flag = str_replace('xxxxx', $part_flag, $known_flag);

                        // Tính MD5 của phần cuối
                        $md5_hash = md5($part_flag);

                        // So sánh với MD5 mục tiêu
                        if ($md5_hash === $target_md5) {
                            echo "Found flag: " . $flag . "\n";
                            exit;
                        }
                    }
                }
            }
        }
    }
?>
```

After approximately 10 minutes of brute-forcing, we get the flag: ```PTITCTF{phP_1s_A_hehe}``` 🎉
